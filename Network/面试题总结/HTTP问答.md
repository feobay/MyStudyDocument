# HTTP



## 1.HTTP是什么？

HTTP，全称Hyper Text Transfer Protocol，超文本传输协议。顾名思义，它就是在计算机世界中两点之间传输 文字、音频、视频 等 超文本 数据的 规范和约定。



## 2.HTTP常见状态码有什么

有**1、2、3、4、5开头的状态码**

- **1开头的的状态码通常表示提示信息**，表示协议处理的中间状态
- **2开头的状态码表示成功**，如
  - **200 OK**，表示一切正常，如果时非 `HEAD` 请求通常还带有body数据
  - **204 No Content**，表示响应头没有body数据
  - **206 Partial Content**，表示响应返回的body数据并非请求资源的全部，而是其中一部分，也属于服务器处理成功的状态，一般用于**HTTP分块下载**或**断点续传**
- **3开头的状态码表示重定向**，如
  - **301 Moved Permanently， 永久重定向，**请求资源已经不存在，要更换url再次访问
  - **302 Found，临时重定向**，临时更换url
    - 301和302都在响应头里使用字段 `Location`，指明后续要跳转的url，浏览器会自动重定向至该url
  - **304 Not Modified，缓存重定向**，不具有跳转含义，表示资源未修改，重定向缓存文件
- **4开头的状态码表示客户端发送报文有误**，是错误码
  - **400 Bad request**，表示客户端请求的报文有错误，但是个笼统的错误
  - **403 Forbidden**，表示服务器禁止访问资源，并不是客户端请求出错
  - **404 Not Found**，表示请求的资源在服务器中不存在或未找到，所以无法提供给客户端
- **5开头的状态码表示服务器处理报文时内部发生了错误**，服务端错误码
  - **500 Internal Server Error**，表示服务器错误，但是个笼统的描述，并不解释原因
  - **501 Not Implement**，表示客户端请求的功能还不支持，类似“即将开业，敬请期待”的意思
  - **502 Bad Gateway**，通常是服务器作为网关或者代理时返回的错误码，表示服务器自身工作正常，访问后端服务器发生错误。
  - **503 Service Unavailable**，表示服务器忙，暂时无法响应客户端



## 3.HTTP常见字段有哪些

- **host**字段，客户端请求时指定服务器域名
- **Content-length**字段，响应报文中表示本次回应数据长度
- **Connection**字段，是否启用HTTP长连接（Keep-Alive）
- **Content-Type**字段，服务端响应时表明本次响应的数据格式
- **Accept**字段，客户端请求时表示自己可接受的数据格式
- **Content-Encoding**字段，服务器响应数据时，说明数据的压缩方法。
- **Accept-Encoding** 字段，说明自己可以接受哪些压缩方法。





## 4.GET和POST有哪些区别

- 首先语义不同
  - **GET**，从服务器获取指定资源；
  - **POST**，根据请求报文的body数据对指定资源做出处理。
    - 当然开发者可以不遵守这个规定自己决定如何处理。

- 其次在安全、幂等性和可缓存方面不同
  - **安全**：指请求不会破坏计算机资源
  - **幂等**：表示无论多少次请求都会得到相同结果
  - **GET方法安全且幂等可缓存**，因为它只读。
  - POST方法不安全不幂等，因为它是新增和提交数据操作

**总结**（回答时直接这样答）

GET 的语义是请求获取指定的资源。GET 方法是安全、幂等、可被缓存的。

POST 的语义是根据请求报文的body对指定的资源做出处理。POST 不安全，不幂等，（大部分实现）不可缓存。



## 5.HTTP缓存有哪些实现方式

强制缓存和协商缓存。



## 6.什么是强制缓存

强制缓存是指只要浏览器缓存的数据没有过期，就从浏览器这边获取缓存数据，选择是否使用缓存是由浏览器决定的。



## 7.强制缓存如何实现的

强制缓存是靠 两个响应头部字段实现的

-  `Cache-Control`，相对时间
- `Expires`，绝对时间

如果同时有这两个字段，那么`Cache-control`的优先级高于Expires。

服务器首次收到请求时在响应报文中添加 `Cache-control`字段；浏览器根据发起请求时间及`Cache-control`大小计算过期时间，未过期使用缓存，过期则再次请求；服务器再次收到请求在响应时更新 `Cache-control`.

> Expries就是到达预设时间缓存过期。
>
> Cache-control的选项更多，设置更精细，所以更推荐使用。其实现流程如下：
>
> - 浏览器第一次请求服务器时，服务器在响应报文中添加 `Cache-control` 字段，设置过期时间大小
> - 当浏览器再次请求时，浏览器通过请求时间和设置的过期时间大小计算出过期时间，若未过期直接使用缓存，若过期则重新请求服务器
> - 服务器再次收到请求后，会重新设置Response头部的 `Cache-control` 大小



## 8.什么是协商缓存

协商缓存就是与服务端协商之后，通过协商结果判断是否使用本地缓存。



## 9.如何实现协商缓存

记住两个东西：Last Modified 和 Etag

1. 通过请求头中的 <font color="red">`If-Modified-Since` </font>字段与响应头部中的<font color="red"> `Last-Modified` </font> 字段实现，这两个字段的意思是：

- 响应头部的 `Last-Modified`: 标识被请求资源的最后修改时间
- 请求头部的 `If-Modified-Since`: 当浏览器发现收到的响应报文中有 `Last-Modified`字段时，就会在下一次请求时将 `If-Modified-Since`字段设置为收到的 `Last-Modified` 的值，服务器收到请求后，将请求报文中的`If-Modified-Since` 字段与本地资源最后修改时间对比（`Last-Modified` ），如果最后修改比较大，说明资源被修改过，返回新资源，响应HTTP 200 OK；若最后修改小于等于 `If-Modified-Since` 字段，那么说明资源无修改，响应 HTTP 304 走缓存。

2. 通过请求头中的<font color="red"> `If-None-Match` </font> 字段与响应头中的<font color="red"> `Etag` </font>字段对比，这两个字段意思是：

- 响应头部中 `Etag`: 唯一标识响应资源。
- 请求头部中的  `If-None-Match` ：当**资源过期时**，浏览器发现响应头里有`Etag`，则再次向服务器发起请求时，会将请求头 `If-None-Match` 值设置为 `Etag` 的值。服务器收到请求后进行对比，如果资源没有变化返回HTTP 304 No Modified，变化了返回 HTTP 200 OK

第一种是基于**修改时间**，第二种是基于**文件唯一标识**

**如果同时有Etag和Last-Modified，那么Etag优先**

<font color="steelblue">**PS：协商缓存这两个字段都必须配合 `Cache-control` 字段使用，只有未命中强制缓存时，才能发起带有协商缓存字段的请求。**</font>





